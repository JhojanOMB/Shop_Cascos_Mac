{% load static %}
{% load custom_filters %}
{% load humanize %}

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Cascos Mac{% endblock %}</title>
  <link rel="shortcut icon" href="{% static 'img/logo2.png' %}" type="image/x-icon">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <script src="{% static 'js/formato.js' %}"></script>
  {% block extra_head %}{% endblock %}

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/lightbox2@2.11.3/dist/css/lightbox.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a08c413a1a.js" crossorigin="anonymous"></script>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>

</head>

<body class="flex flex-col min-h-screen bg-white text-gray-800">
  <!-- Navbar -->
  <header class="hidden md:flex items-center justify-between {{ UI_COLORS.navbar_bg }} {{ UI_COLORS.navbar_text }} px-8 py-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between w-full">
      <a href="{% url 'index' %}" class="flex items-center space-x-2">
        <img src="{% static 'img/logo2.png' %}" alt="Logo Cascos Mac" class="h-8 w-8">
        <span class="text-xl font-bold">Cascos Mac</span>
      </a>
      <div class="flex-1 px-4">
        {% if request.resolver_match.url_name in 'index product_detail buscar_productos' %}
        <form method="get" action="{% url 'buscar_productos' %}" class="w-full">
          <div class="flex items-center bg-gray-100 text-black rounded-full overflow-hidden border border-gray-300">
            <input type="search" name="q" placeholder="Buscar productos..."
              class="flex-1 px-4 py-2 focus:outline-none"
              value="{{ request.GET.q }}">
            <button type="submit" class="px-4">
              <i class="fas fa-search text-gray-500"></i>
            </button>
          </div>
        </form>
        {% endif %}
      </div>
      <div class="flex items-center space-x-4">
        {% block header_links %}{% endblock %}
      </div>
    </div>
  </header>

  <!-- Navbar móvil -->
  <nav class="md:hidden {{ UI_COLORS.navbar_bg|default:'bg-gray-900' }} {{ UI_COLORS.navbar_text|default:'text-white' }} sticky top-0 z-40">
    <div class="flex items-center justify-between px-4 py-3">
      <a href="{% url 'index' %}" class="flex items-center {{ UI_COLORS.navbar_text|default:'text-white' }}">
        <img src="{% static 'img/logo2.png' %}" alt="Logo Cascos Mac" class="h-7 w-7 mr-2">
        <span class="text-lg font-bold">Cascos Mac</span>
      </a>
      <button id="mobile-open" class="md:hidden focus:outline-none {{ UI_COLORS.navbar_text|default:'text-white' }} p-2 rounded-lg hover:bg-gray-700">
        <i class="fa fa-bars text-2xl"></i>
      </button>
    </div>
  </nav>

  <!-- Overlay móvil -->
  <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[9998] md:hidden"></div>

  <!-- Menú móvil -->
  <aside id="mobile-menu" class="fixed top-0 left-0 h-full w-72 {{ UI_COLORS.sidebar_bg|default:'bg-white' }} shadow-lg transition-transform duration-300 z-[9999] overflow-y-auto -translate-x-full md:hidden">
    <div class="flex items-center justify-between px-4 py-3 border-b">
      <span class="font-semibold text-lg">Menú</span>
      <button id="mobile-close" class="focus:outline-none text-gray-600 hover:text-gray-900 p-2 rounded-lg hover:bg-gray-200">
        <i class="fa fa-times text-2xl"></i>
      </button>
    </div>
    <ul class="space-y-2">
    {% block mobile_header_links %}{% endblock %}
    </ul>
  </aside>

  <!-- Main content -->
  <main class="flex-1 overflow-y-auto p-6">
    {% block content %}{% endblock %}
  </main>

  <!-- floating actions: carrito y whatsapp -->
  <div class="fixed bottom-6 right-6 z-50 flex flex-col gap-4 items-end">
    <!-- carrito -->
    <button id="open-mini-cart" class="relative w-14 h-14 bg-white rounded-full shadow-md flex items-center justify-center">
      <i class="fa-solid fa-cart-shopping text-black text-2xl"></i>
      <span id="cart-count"
            class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">
        {{ total_items_carrito }}
      </span>
    </button>

    <!-- whatsapp -->
    <a href="https://wa.me/573212692311" target="_blank" class="group">
      <div class="floating-card bg-green-500 rounded-full p-3 border flex items-center justify-center w-14 h-14">
        <i class="fa-brands fa-whatsapp text-white text-2xl"></i>
      </div>
    </a>
  </div>


  <!-- Mini-cart modal (off-canvas) -->
  <div id="mini-cart-modal" class="fixed inset-0 z-50 hidden">
    <div id="mini-cart-overlay" class="absolute inset-0 bg-black bg-opacity-50"></div>

    <div class="absolute right-0 top-0 h-full w-80 bg-white shadow-lg p-4 overflow-auto">
      <button id="close-mini-cart" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">
        <i class="fa-solid fa-xmark"></i>
      </button>

      {% if mini_cart_items %}
        <ul class="divide-y divide-gray-200">
          {% for item in mini_cart_items %}
            <li class="flex items-center py-2">
              <img src="{{ item.imagen_url|default:'/static/img/No_hay_imagen.png' }}" alt="{{ item.producto_nombre }}" class="w-12 h-12 object-cover rounded mr-2" />
              <div class="flex-1 text-sm">
                <p class="font-semibold truncate">{{ item.producto_nombre }}</p>
                <p class="text-gray-500">Cant: {{ item.cantidad }}</p>
              </div>
              <span class="text-sm font-semibold">${{ item.subtotal|intcomma }}</span>
            </li>
          {% endfor %}
        </ul>

        <div class="mt-3 border-t pt-3 text-right font-bold">
          Total: ${{ mini_cart_total|intcomma }}
        </div>

        <div class="mt-4 flex gap-2">
          <a href="{% url 'carrito:ver_carrito' %}" class="flex-1 bg-green-500 text-white py-2 rounded-md text-center hover:bg-green-600 transition">
            Ver Carrito
          </a>
          <a href="#" class="flex-1 bg-blue-500 text-white py-2 rounded-md text-center hover:bg-blue-600 transition">
            Pagar
          </a>
        </div>
      {% else %}
        <p class="text-center text-gray-500 py-6">Tu carrito está vacío.</p>
      {% endif %}
    </div>
  </div>


<script>
  const openBtn = document.getElementById('open-mini-cart');
  const closeBtn = document.getElementById('close-mini-cart');
  const overlay = document.getElementById('mini-cart-overlay');
  const modal = document.getElementById('mini-cart-modal');

  openBtn.addEventListener('click', () => {
    modal.classList.remove('hidden');
  });

  closeBtn.addEventListener('click', () => {
    modal.classList.add('hidden');
  });

  overlay.addEventListener('click', () => {
    modal.classList.add('hidden');
  });
</script>


  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-4">
    <div class="max-w-7xl mx-auto text-center px-4">
      <p class="text-sm mb-1">&copy; 2025 Cascos Mac. Todos los derechos reservados.</p>
      <p class="text-sm">
        <a href="https://jhojanomb.github.io/JOMB/" class="underline hover:text-gray-300">Hecho por JOMB</a>
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const openBtn = document.getElementById('mobile-open');
      const closeBtn = document.getElementById('mobile-close');
      const menu = document.getElementById('mobile-menu');
      const overlay = document.getElementById('mobile-overlay');
      if (openBtn && closeBtn && menu && overlay) {
        openBtn.addEventListener('click', () => {
          menu.classList.remove('-translate-x-full');
          overlay.classList.remove('hidden');
          document.body.classList.add('overflow-hidden');
        });
        closeBtn.addEventListener('click', () => {
          menu.classList.add('-translate-x-full');
          overlay.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        });
        overlay.addEventListener('click', () => {
          menu.classList.add('-translate-x-full');
          overlay.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        });
      }
    });
  </script>

  <script src="{% static 'js/carrito.js' %}"></script>

  {% block extra_js %}{% endblock %}
  
</body>

</html>
