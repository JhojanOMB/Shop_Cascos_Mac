{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% block header_links %}{% endblock %}
  <title>{% block title %}Dashboard Mac Cascos{% endblock %}</title>

  <!-- Favicon y CSS propios -->
  <link rel="shortcut icon" href="{% static 'img/logo2.png' %}" type="image/x-icon">
  <link rel="stylesheet" href="{% static 'css/base_dash.css' %}">
  <script src="{% static 'js/formato.js' %}"></script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/lightbox2@2.11.3/dist/css/lightbox.min.css" rel="stylesheet">

  <!-- jQuery, Chart.js, html2pdf -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Alpine.js -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

</head>

<body class="flex flex-col min-h-screen">

  <!-- Navbar escritorio -->
    <header class="hidden md:flex items-center justify-between {{ UI_COLORS.navbar_bg }} {{ UI_COLORS.navbar_text }} px-8 py-4">
    <a href="{% url 'index' %}" class="flex items-center">
      <img src="{% static 'img/logo2.png' %}" alt="Logo Mac Cascos" class="h-8 w-8 mr-2">
      <span class="text-2xl font-semibold">Cascos Mac</span>
    </a>
    {% if user.is_authenticated %}
      <a href="{% url 'logout' %}" class="px-4 py-2 {{ UI_COLORS.button_bg }} {{ UI_COLORS.button_hover }} rounded">Cerrar Sesión</a>
    {% else %}
      <a href="{% url 'index' %}" class="px-4 py-2 border border-white rounded {{ UI_COLORS.button_hover }} transition">Volver al Inicio</a>
    {% endif %}
  </header>

  <!-- Navbar móvil -->
  <nav class="md:hidden {{ UI_COLORS.navbar_bg }} {{ UI_COLORS.navbar_text }} sticky top-0 z-30">
    <div class="flex items-center justify-between px-4 py-3">
      <a href="{% url 'index' %}" class="flex items-center {{ UI_COLORS.navbar_text }}">
        <img src="{% static 'img/logo2.png' %}" alt="Logo Mac Cascos" class="h-6 w-6 mr-2">
        Mac Cascos
      </a>
      <button id="mobile-open" class="focus:outline-none {{ UI_COLORS.navbar_text }}">
        <i class="fa fa-bars text-2xl"></i>
      </button>
    </div>
  </nav>

  <!-- Overlay móvil -->
  <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-20"></div>

  <!-- Menú móvil off‑canvas -->
  <aside id="mobile-menu"
         class="fixed top-0 right-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform z-30 overflow-y-auto">
    <div class="flex items-center justify-between px-4 py-3 border-b">
      <span class="font-semibold">Menú</span>
      <button id="mobile-close" class="focus:outline-none text-gray-600 hover:text-gray-900">
        <i class="fa fa-times text-2xl"></i>
      </button>
    </div>
    <ul class="mt-4">
      {% for key, url_name in menu_items %}
        {% url url_name as item_url %}
        <li>
          <a href="{{ item_url }}"
             class="flex items-center px-4 py-2 {{ UI_COLORS.sidebar_text }} {{ UI_COLORS.sidebar_hover }}
                    {% if request.resolver_match.url_name == url_name %} bg-gray-200 font-semibold text-gray-900{% endif %}">
            <i class="fa {{ UI_ICON_MAP|get_item:key }} mr-3"></i>
            {{ key|capfirst }}
          </a>
        </li>
      {% endfor %}
      {% if 'configuracion' in UI_PERMISSIONS|get_item:user.rol %}
        <li class="mt-2 border-t pt-2">
          {% url 'ui_settings' as cfg_url %}
          <a href="{{ cfg_url }}"
             class="flex items-center px-4 py-2 {{ UI_COLORS.sidebar_text }} {{ UI_COLORS.sidebar_hover }}">
            <i class="fa {{ UI_ICON_MAP|get_item:'configuracion' }} mr-3"></i>
            Configuración
          </a>
        </li>
      {% endif %}
    </ul>
    {% if user.is_authenticated %}
      <a href="{% url 'logout' %}"
         class="mt-4 block w-full text-center px-4 py-2 {{ UI_COLORS.button_bg }} {{ UI_COLORS.button_hover }} {{ UI_COLORS.navbar_text }} rounded">
        Cerrar Sesión
      </a>
    {% endif %}
  </aside>

  <div class="flex flex-1">

    {% if user.is_authenticated %}
      <!-- Sidebar escritorio -->
      <aside class="hidden md:flex flex-col w-64 {{ UI_COLORS.sidebar_bg }} border-r">
        <div class="p-4 border-b">
          <p class="font-medium text-gray-800">{{ user.get_full_name|default:user.username }}</p>
        </div>
        <nav class="mt-4 flex-1 overflow-y-auto">
          <ul class="space-y-1">
            {% for key, url_name in menu_items %}
              {% url url_name as item_url %}
              <li>
                <a href="{{ item_url }}"
                   class="flex items-center px-4 py-2 {{ UI_COLORS.sidebar_text }} {{ UI_COLORS.sidebar_hover }}
                          {% if request.resolver_match.url_name == url_name %} bg-gray-200 font-semibold text-gray-900{% endif %}">
                  <i class="fa {{ UI_ICON_MAP|get_item:key }} mr-3"></i>
                  {{ key|capfirst }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </nav>
      </aside>
    {% endif %}

    <!-- Contenido principal -->
    <main class="flex-1 overflow-y-auto ml-0 bg-white">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    const openBtn   = document.getElementById('mobile-open'),
          closeBtn  = document.getElementById('mobile-close'),
          menu      = document.getElementById('mobile-menu'),
          overlay   = document.getElementById('mobile-overlay');

    openBtn?.addEventListener('click', () => {
      menu.classList.remove('translate-x-full');
      overlay.classList.remove('hidden');
    });
    closeBtn?.addEventListener('click', () => {
      menu.classList.add('translate-x-full');
      overlay.classList.add('hidden');
    });
    overlay?.addEventListener('click', () => {
      menu.classList.add('translate-x-full');
      overlay.classList.add('hidden');
    });
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
